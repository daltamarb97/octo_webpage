<div *ngIf="!companyInfo.forms">
    <h1>Tu empresa no tiene formularios activos en este momento</h1>
    <h3>Contáctanos a <a href="https://weareocto.web.app/front/pages/contact.html" target="_blank" style="color: #EF78A0">octo.colombia@gmail.com</a> para cear tu primer formulario</h3>
</div>
<div fxLayout="row wrap" *ngIf="companyInfo.forms">
    <div fxFlex.gt-sm="100" fxFlex.gt-xs="100" fxFlex="100">
        <mat-card>
        <mat-card-content>
            <div class="header-drop">
                <div class="header-drop-sub">
                    <mat-card-title *ngIf="currentForm">Resumen de información de: {{currentForm.alias | titlecase}}</mat-card-title>
                    <mat-card-subtitle *ngIf="showTable && currentForm && !currentForm.foreign">Para abrir Octo Form Builder, 
                        <span style="color: #E83D5E" (click)="showTable = false">haz click aqui</span> 
                    </mat-card-subtitle>
                    <mat-card-subtitle *ngIf="!showTable && currentForm && !currentForm.foreign">Para ver tabla de resultados, 
                        <span style="color: #E83D5E" (click)="showTable = true">haz click aqui</span> 
                    </mat-card-subtitle>
                </div>
                <mat-form-field appearance="fill">
                    <mat-label>Seleciona un formulario</mat-label>
                    <mat-select>
                        <mat-option *ngFor="let form of forms" (click)="changeForm(form)">{{form.alias}}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="bg-light p-10 p-r-20 p-l-20" *ngIf="showTable">
                <mat-form-field>
                    <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Search (Filter)">
                </mat-form-field>
            </div>
            <div class="search-field" *ngIf="currentForm && currentForm.foreign">
                <mat-form-field>
                    <input matInput type="number" [(ngModel)]="sortNumber" placeholder="¿cuántos campos quieres buscar?">
                </mat-form-field>
                <button mat-stroked-button color="primary" (click)="searchFields()">Confirmar</button>
            </div>
            <div class="responsive-table" *ngIf="showTable">
                <table mat-table [dataSource]="dataSource" multiTemplateDataRows class="mat-elevation-z8">
                    <ng-container matColumnDef="{{column}}" *ngFor="let column of columnsToDisplay">
                        <th mat-header-cell *matHeaderCellDef> {{column}} </th>
                        <td mat-cell *matCellDef="let element"> {{(column !== 'acciones') 
                            ? element[column] 
                            : ''}}
                            <button mat-stroked-button (click)="openTicket(element)" *ngIf="column === 'acciones'">Abrir Ticket</button>
                        </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
                    <tr mat-row *matRowDef="let element; columns: columnsToDisplay;" class="example-element-row"></tr>
                </table>
            </div>

            <div class="bubble" *ngIf="!showTable">
                <mat-vertical-stepper [linear]="isLinear" #stepper>
                    <mat-step *ngFor="let message of formFlow">
                        <ng-template matStepLabel>{{(message.alias) ? message.alias : 'Final' }}</ng-template>
                        <div *ngIf="!edition">
                            <p><span style="font-weight: bold">Mensaje: </span>{{message.message}}</p>
                            <p *ngIf="!message.end"><span style="font-weight: bold">Tipo de respuesta: </span>{{(message.responseType === 'number') ? 'Número' : 'Palabra/frase'}}</p>
                        </div>
                        <div *ngIf="edition">
                            <mat-form-field class="example-full-width">
                                <mat-label>Mensaje</mat-label>
                                <input matInput placeholder="Escribe el mensaje aqui..." [(ngModel)]="messageEdition">
                            </mat-form-field>
                            <mat-form-field class="example-full-width" *ngIf="!message.end">
                                <mat-label>Tipo de respuesta</mat-label>
                                <select matNativeControl [(ngModel)]="typeMessageEdition">
                                    <option value="number">Número</option>
                                    <option value="string">Palabra/Frase</option>
                                </select>
                            </mat-form-field>
                            <p *ngIf="missingEditInfo" style="color: red;">Falta información en los campos</p>
                            <div class="edit-buttons">
                                <button mat-stroked-button color="primary" (click)="confirmMessageChanges(message)">Confirmar</button>
                                <button mat-stroked-button (click)="cancelChanges()">Cancelar</button>
                            </div>
                        </div>
                        <button mat-mini-fab style="background-color: #E83D5E" aria-label="Edit message" *ngIf="!message.main && !edition" (click)="edition = !edition">
                            <mat-icon>create</mat-icon>
                        </button>
                    </mat-step>
                </mat-vertical-stepper>
            </div>
        </mat-card-content>
        </mat-card>
    </div>
    </div>